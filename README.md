# 3DCollage
For CMPT 464 - A project to design 3D collages from an input mesh and substituent meshes through weak convex decomposition and PCA shape matching



Guidelines to use the program:


1. Type in a filename and press enter to load in a base object. It will be displayed on the smf_view window.

2. Type in component object files and press "Load file" to generate PCAs for the objects. Enter another object file name to generate more PCAs of differenct objects. Matlab window will pop up.

3. Type in the number of segments you want and press "Voxel Segment". It will segment the base object into cluster and generate each of their PCAs. Use the drop down menu and select "segmented" to view the segmented base object.

4. Press "Collagify" to generate results. Matlab windows will pop up and display its current progress on collaging objects.

5. "newMesh.smf" create in the project folder stores the result.




Setting Guilines:


The program can only be ran on Mac with Xcode and requires Matlab engine to run.
Xcode and envirnment setup for matlab engine

1. Add Link Binary with libraries:
Go to Targets -> Build Phases
Add libeng.dylib and libmx.dylib from the project folder or from Matlab's own folder

2. Project Build Settings:
Go to build settings search "Library Search Paths" add 
[matlab.app_root]/bin/maci64
e.g. on Mac
/Applications/MATLAB_R2015b.app/bin/maci64

3. Environments settings:
At the menu bar click on Product -> schemes ->edit scheme ->Run ->Arguments
At Environment Variables add:
Name:
DYLD_LIBRARY_PATH
Value:		
[matlab.root]/bin/maci64:/[matlab.root]/sys/os/maci64:$DYLD_LIBRARY_PATH
e.g. for mac
/Applications/MATLAB_R2015b.app/bin/maci64:/Applications/MATLAB_R2015b.app/sys/os/maci64:$DYLD_LIBRARY_PATH


Possible errors and their solutions regarding Matlab engine:

1. Matlab engine MacOSX SDK not found error:
In MATLAB_R2015b/bin/maci64/mexopts/clang_maci64.xml and 
MATLAB_R2015b/bin/maci64/mexopts/clang++_maci64.xml,
change sdk file to the machine's sdk version
<dirExists name="$$/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk" />
and 
<cmdReturns name="find $$ -name MacOSX10.10.sdk" />

to 
<dirExists name="$$/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk" />
and
<cmdReturns name="find $$ -name MacOSX10.11.sdk" />

you can check your Mac's SDK version at
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs

2. Java error
It happens occasionally, restart the program may solve the error.

3. Reference error to smf files or other required files
This happenes when Xcode could not find the files, go to Products-> Schemes ->edit scheme -> Run (at the left bar) -> Options and add a custom working directory to the folder that holds the files needed.


Note:

1. Since newMesh file is generated everytime the program runs, the program will clear files related to the program before running. Users should store desirable newMeshes before running the next test.


Testing:

Matlab functions can be tested separately, Cluster PCA can be generated by running the main program, the file storing cluster PCAs will be generated and the Matlab program will read in the file automatically.

For newMesh.m, it could be tested by typing commands in Matlab environment. Typing in a filename and a cluster index say 
>> newMesh('bigFish.smf', 0);
This will transform the fish mesh and fit it to the primary PCA asix of the cluster 0
by typing another test
>> newMesh('man.smf', 0);
the program will transform the mesh and append it to the previously created newMesh.smf file. It will then prompt to display the two objects at the transformed positions.



